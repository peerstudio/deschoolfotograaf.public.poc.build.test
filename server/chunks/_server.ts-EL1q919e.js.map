{"version":3,"file":"_server.ts-EL1q919e.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/validate-address/_server.ts.js"],"sourcesContent":["!(function() {\n  try {\n    var e = \"undefined\" != typeof window ? window : \"undefined\" != typeof global ? global : \"undefined\" != typeof globalThis ? globalThis : \"undefined\" != typeof self ? self : {};\n    e.SENTRY_RELEASE = { id: \"99069e462683fde0ac533c0f9d57bdbde12d31be\" };\n  } catch (e2) {\n  }\n})();\n;\n{\n  try {\n    (function() {\n      var e = \"undefined\" != typeof window ? window : \"undefined\" != typeof global ? global : \"undefined\" != typeof globalThis ? globalThis : \"undefined\" != typeof self ? self : {}, n = new e.Error().stack;\n      n && (e._sentryDebugIds = e._sentryDebugIds || {}, e._sentryDebugIds[n] = \"608932f8-539d-4589-84c0-674a0a690fcb\", e._sentryDebugIdIdentifier = \"sentry-dbid-608932f8-539d-4589-84c0-674a0a690fcb\");\n    })();\n  } catch (e) {\n  }\n}\n;\nimport { json } from \"@sveltejs/kit\";\nconst POST = async ({ request }) => {\n  try {\n    const body = await request.json();\n    const { street, houseNumber, postalCode, city, box } = body;\n    const BPOST_API_URL = \"https://api.mailops.bpost.cloud/roa-info/externalMailingAddressProofingRest/validateAddresses\";\n    const validationRequest = {\n      ValidateAddressesRequest: {\n        AddressToValidate: [\n          {\n            \"@id\": \"1\",\n            PostalAddress: {\n              DeliveryPointLocation: {\n                StructuredDeliveryPointLocation: {\n                  StreetName: street,\n                  StreetNumber: houseNumber,\n                  BoxNumber: box || void 0,\n                  PostalCode: postalCode,\n                  MunicipalityName: city\n                }\n              }\n            }\n          }\n        ]\n      }\n    };\n    const response = await fetch(BPOST_API_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-api-key\": \"xxxyour_api_key_herexxx\"\n      },\n      body: JSON.stringify(validationRequest)\n    });\n    if (!response.ok) {\n      console.error(\"Bpost API error:\", response.statusText);\n      return json({\n        valid: false,\n        message: \"Address validation service temporarily unavailable\"\n      });\n    }\n    const data = await response.json();\n    const validatedAddresses = data?.ValidateAddressesResponse?.ValidatedAddress;\n    if (!validatedAddresses || validatedAddresses.length === 0) {\n      return json({\n        valid: false,\n        message: \"Could not validate address\"\n      });\n    }\n    const validatedAddress = validatedAddresses[0];\n    const error = validatedAddress?.Error;\n    if (error) {\n      const suggestions = [];\n      if (validatedAddress.ValidatedPostalAddress) {\n        const suggested = validatedAddress.ValidatedPostalAddress;\n        const deliveryPoint = suggested.DeliveryPointLocation?.StructuredDeliveryPointLocation;\n        if (deliveryPoint) {\n          suggestions.push({\n            streetName: deliveryPoint.StreetName || street,\n            postalCode: deliveryPoint.PostalCode || postalCode,\n            municipalityName: deliveryPoint.MunicipalityName || city,\n            houseNumber: deliveryPoint.StreetNumber || houseNumber,\n            boxNumber: deliveryPoint.BoxNumber\n          });\n        }\n      }\n      return json({\n        valid: false,\n        suggestions: suggestions.length > 0 ? suggestions : void 0,\n        message: error.ErrorDescription || \"Address could not be validated\"\n      });\n    }\n    return json({\n      valid: true,\n      message: \"Address validated successfully\"\n    });\n  } catch (error) {\n    console.error(\"Address validation error:\", error);\n    return json(\n      {\n        valid: false,\n        message: \"Address validation failed\"\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;AAAA,CAAC,CAAC,WAAW;AACb,EAAE,IAAI;AACN,IAAI,IAAI,CAAC,GAAG,WAAW,IAAI,OAAO,MAAM,GAAG,MAAM,GAAG,WAAW,IAAI,OAAO,MAAM,GAAG,MAAM,GAAG,WAAW,IAAI,OAAO,UAAU,GAAG,UAAU,GAAG,WAAW,IAAI,OAAO,IAAI,GAAG,IAAI,GAAG,EAAE;AAClL,IAAI,CAAC,CAAC,cAAc,GAAG,EAAE,EAAE,EAAE,0CAA0C,EAAE;AACzE,EAAE,CAAC,CAAC,OAAO,EAAE,EAAE;AACf,EAAE;AACF,CAAC,GAAG;AAEJ;AACA,EAAE,IAAI;AACN,IAAI,CAAC,WAAW;AAChB,MAAM,IAAI,CAAC,GAAG,WAAW,IAAI,OAAO,MAAM,GAAG,MAAM,GAAG,WAAW,IAAI,OAAO,MAAM,GAAG,MAAM,GAAG,WAAW,IAAI,OAAO,UAAU,GAAG,UAAU,GAAG,WAAW,IAAI,OAAO,IAAI,GAAG,IAAI,GAAG,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,KAAK;AAC7M,MAAM,CAAC,KAAK,CAAC,CAAC,eAAe,GAAG,CAAC,CAAC,eAAe,IAAI,EAAE,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,GAAG,sCAAsC,EAAE,CAAC,CAAC,wBAAwB,GAAG,kDAAkD,CAAC;AACxM,IAAI,CAAC,GAAG;AACR,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE;AACd,EAAE;AACF;AAGK,MAAC,IAAI,GAAG,OAAO,EAAE,OAAO,EAAE,KAAK;AACpC,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACrC,IAAI,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,IAAI;AAC/D,IAAI,MAAM,aAAa,GAAG,+FAA+F;AACzH,IAAI,MAAM,iBAAiB,GAAG;AAC9B,MAAM,wBAAwB,EAAE;AAChC,QAAQ,iBAAiB,EAAE;AAC3B,UAAU;AACV,YAAY,KAAK,EAAE,GAAG;AACtB,YAAY,aAAa,EAAE;AAC3B,cAAc,qBAAqB,EAAE;AACrC,gBAAgB,+BAA+B,EAAE;AACjD,kBAAkB,UAAU,EAAE,MAAM;AACpC,kBAAkB,YAAY,EAAE,WAAW;AAC3C,kBAAkB,SAAS,EAAE,GAAG,IAAI,KAAK,CAAC;AAC1C,kBAAkB,UAAU,EAAE,UAAU;AACxC,kBAAkB,gBAAgB,EAAE;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,aAAa,EAAE;AAChD,MAAM,MAAM,EAAE,MAAM;AACpB,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,kBAAkB;AAC1C,QAAQ,WAAW,EAAE;AACrB,OAAO;AACP,MAAM,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,iBAAiB;AAC5C,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AACtB,MAAM,OAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,QAAQ,CAAC,UAAU,CAAC;AAC5D,MAAM,OAAO,IAAI,CAAC;AAClB,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,OAAO,EAAE;AACjB,OAAO,CAAC;AACR,IAAI;AACJ,IAAI,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE;AACtC,IAAI,MAAM,kBAAkB,GAAG,IAAI,EAAE,yBAAyB,EAAE,gBAAgB;AAChF,IAAI,IAAI,CAAC,kBAAkB,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC,EAAE;AAChE,MAAM,OAAO,IAAI,CAAC;AAClB,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,OAAO,EAAE;AACjB,OAAO,CAAC;AACR,IAAI;AACJ,IAAI,MAAM,gBAAgB,GAAG,kBAAkB,CAAC,CAAC,CAAC;AAClD,IAAI,MAAM,KAAK,GAAG,gBAAgB,EAAE,KAAK;AACzC,IAAI,IAAI,KAAK,EAAE;AACf,MAAM,MAAM,WAAW,GAAG,EAAE;AAC5B,MAAM,IAAI,gBAAgB,CAAC,sBAAsB,EAAE;AACnD,QAAQ,MAAM,SAAS,GAAG,gBAAgB,CAAC,sBAAsB;AACjE,QAAQ,MAAM,aAAa,GAAG,SAAS,CAAC,qBAAqB,EAAE,+BAA+B;AAC9F,QAAQ,IAAI,aAAa,EAAE;AAC3B,UAAU,WAAW,CAAC,IAAI,CAAC;AAC3B,YAAY,UAAU,EAAE,aAAa,CAAC,UAAU,IAAI,MAAM;AAC1D,YAAY,UAAU,EAAE,aAAa,CAAC,UAAU,IAAI,UAAU;AAC9D,YAAY,gBAAgB,EAAE,aAAa,CAAC,gBAAgB,IAAI,IAAI;AACpE,YAAY,WAAW,EAAE,aAAa,CAAC,YAAY,IAAI,WAAW;AAClE,YAAY,SAAS,EAAE,aAAa,CAAC;AACrC,WAAW,CAAC;AACZ,QAAQ;AACR,MAAM;AACN,MAAM,OAAO,IAAI,CAAC;AAClB,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,WAAW,EAAE,WAAW,CAAC,MAAM,GAAG,CAAC,GAAG,WAAW,GAAG,KAAK,CAAC;AAClE,QAAQ,OAAO,EAAE,KAAK,CAAC,gBAAgB,IAAI;AAC3C,OAAO,CAAC;AACR,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,KAAK,EAAE,IAAI;AACjB,MAAM,OAAO,EAAE;AACf,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,KAAK,CAAC;AACrD,IAAI,OAAO,IAAI;AACf,MAAM;AACN,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,OAAO,EAAE;AACjB,OAAO;AACP,MAAM,EAAE,MAAM,EAAE,GAAG;AACnB,KAAK;AACL,EAAE;AACF;;;;"}